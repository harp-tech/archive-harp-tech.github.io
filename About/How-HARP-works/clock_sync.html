
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Synchronization Clock &#8212; HARP Documentation 0.0.0 documentation</title>
  <script>
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=9b1a4fa89bdd0e95b23b" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=9b1a4fa89bdd0e95b23b" rel="stylesheet">

  
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=9b1a4fa89bdd0e95b23b">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'About/How-HARP-works/clock_sync';</script>
    <script src="../../_static/_static/custom.js"></script>
    <link rel="shortcut icon" href="../../_static/harp.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Harp device common registers and operation" href="common_registers_operation_devices.html" />
    <link rel="prev" title="Harp Binary Protocol" href="binary_protocol.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="docsearch:language" content="en">
  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="">

  
  <input type="checkbox" class="sidebar-toggle" name="__primary" id="__primary">
  <label class="overlay overlay-primary" for="__primary"></label>

  
  <input type="checkbox" class="sidebar-toggle" name="__secondary" id="__secondary">
  <label class="overlay overlay-secondary" for="__secondary"></label>

  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
      
<form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
    </div>
  </div>

  
  <nav class="bd-header navbar navbar-expand-lg bd-navbar" id="navbar-main"><div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
      <span class="fas fa-bars"></span>
  </label>
  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="../../index.html">

  
  
  
  
  
  
  

  
    <img src="../../_static/harp.png" class="logo__image only-light" alt="Logo image">
    <img src="../../_static/harp.png" class="logo__image only-dark" alt="Logo image">
  
  
</a>
    
  </div>

  
  <div class="col-lg-9 navbar-header-items">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                <li class="nav-item">
                    <a class="nav-link" href="../index.html">
                        About
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../../Devices/device_list.html">
                        Device List
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../Using-HARP/index.html">
                        Using HARP
                    </a>
                </li>
                

                <li class="nav-item current active">
                    <a class="nav-link" href="index.html">
                        Harp Protocols
                    </a>
                </li>
                
    </ul>
</nav>
      </div>
      
    </div>

    <div id="navbar-end">
      <div class="navbar-end-item navbar-end__search-button-container">
        
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search">
  <i class="fas fa-search"></i>
</button>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
      <div class="navbar-end-item">
        
<form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
      </div>
      
    </div>
  </div>


  
  <div class="search-button-container--mobile">
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search">
  <i class="fas fa-search"></i>
</button>
  </div>

  
  <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fas fa-outdent"></span>
  </label>
  

</div>
  </nav>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        
  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                <li class="nav-item">
                    <a class="nav-link" href="../index.html">
                        About
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../../Devices/device_list.html">
                        Device List
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../Using-HARP/index.html">
                        Using HARP
                    </a>
                </li>
                

                <li class="nav-item current active">
                    <a class="nav-link" href="index.html">
                        Harp Protocols
                    </a>
                </li>
                
    </ul>
</nav>
      </div>
      
      </div>
    

    
    
    <div class="sidebar-header-items__end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
      <div class="navbar-end-item">
        
<form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
      </div>
      
    </div>
    
  </div>

  

  
  <div class="sidebar-end-items sidebar-primary__section">
    <div class="sidebar-end-items__item">
    </div>
  </div>

      </div>
      <main class="bd-main">
        
        
        <div class="bd-content">
          <div class="bd-article-container">
            
            <div class="bd-header-article">
                
            </div>
            
            
            <article class="bd-article" role="main">
              
  <section id="synchronization-clock">
<span id="refclocksync"></span><h1>Synchronization Clock<a class="headerlink" href="#synchronization-clock" title="Permalink to this heading">#</a></h1>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#introduction" id="id1">1. Introduction</a></p></li>
<li><p><a class="reference internal" href="#serial-configuration" id="id2">2. Serial configuration</a></p></li>
<li><p><a class="reference internal" href="#example-code" id="id3">3. Example code</a></p></li>
<li><p><a class="reference internal" href="#physical-connection" id="id4">4. Physical connection</a></p></li>
</ul>
</nav>
<p>One of the most important features of Harp is the ability of all Harp devices to share the same clock. Because any registered event is timestamped on the same clock, the temporal sequence of events is accurately determined even if events are detected by different devices.</p>
<section id="introduction">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">1. Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this heading">#</a></h2>
<p>The Harp Synchronization Clock is a bus that disseminates the actual current time to Harp devices.
It’s a serial communication containing the time information. Each device uses the last byte of the
transmission to align themselves with the current time.</p>
</section>
<section id="serial-configuration">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">2. Serial configuration</a><a class="headerlink" href="#serial-configuration" title="Permalink to this heading">#</a></h2>
<p>Baud rate used is 100 kbps.</p>
<p>The last byte starts <strong>exactly</strong> 672 us before the elapse of the current second (picture below).</p>
<p>The packet is composed of 6 bytes (header[2] and timestamp_s[4])
- header[2] = {0xAA, 0xAF)
- The timestamp_s is of type uint32 little-endian and contains the current second</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>IMPORTANT</p>
<p>Since there’s no checksum to validate the packet, the sender must make sure that, if the header sequence is present in the, the packet is not sent.</p>
</div>
</section>
<section id="example-code">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">3. Example code</a><a class="headerlink" href="#example-code" title="Permalink to this heading">#</a></h2>
<p>Example of a microcontroller C code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ISR</span><span class="p">(</span><span class="n">TCD0_OVF_vect</span><span class="p">,</span> <span class="n">ISR_NAKED</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">((</span><span class="o">*</span><span class="n">timestamp_byte0</span> <span class="o">==</span> <span class="mh">0xAA</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">*</span><span class="n">timestamp_byte1</span> <span class="o">==</span> <span class="mh">0xAF</span><span class="p">))</span> <span class="n">reti</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">((</span><span class="o">*</span><span class="n">timestamp_byte1</span> <span class="o">==</span> <span class="mh">0xAA</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">*</span><span class="n">timestamp_byte2</span> <span class="o">==</span> <span class="mh">0xAF</span><span class="p">))</span> <span class="n">reti</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">((</span><span class="o">*</span><span class="n">timestamp_byte2</span> <span class="o">==</span> <span class="mh">0xAA</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">*</span><span class="n">timestamp_byte3</span> <span class="o">==</span> <span class="mh">0xAF</span><span class="p">))</span> <span class="n">reti</span><span class="p">();</span>

        <span class="n">switch</span> <span class="p">(</span><span class="n">timestamp_tx_counter</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">case</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">USARTD1_DATA</span> <span class="o">=</span> <span class="mh">0xAA</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">USARTD1_DATA</span> <span class="o">=</span> <span class="mh">0xAF</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">USARTD1_DATA</span> <span class="o">=</span> <span class="o">*</span><span class="n">timestamp_byte0</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="mi">6</span><span class="p">:</span>
            <span class="n">USARTD1_DATA</span> <span class="o">=</span> <span class="o">*</span><span class="n">timestamp_byte1</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="mi">7</span><span class="p">:</span>
            <span class="n">USARTD1_DATA</span> <span class="o">=</span> <span class="o">*</span><span class="n">timestamp_byte2</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="mi">1998</span><span class="p">:</span>
            <span class="n">USARTD1_DATA</span> <span class="o">=</span> <span class="o">*</span><span class="n">timestamp_byte3</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
</pre></div>
</div>
</section>
<section id="physical-connection">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">4. Physical connection</a><a class="headerlink" href="#physical-connection" title="Permalink to this heading">#</a></h2>
<p>The physical connection is made by a simple audio cable.</p>
<p>The connector used is from Switchcraft Inc. and has the part number 35RASMT2BHNTRX</p>
</section>
</section>


            </article>
            
            
            
            <footer class="bd-footer-article">
                <!-- Previous / next buttons -->
<div class='prev-next-area'>
  <a class='left-prev' id="prev-link" href="binary_protocol.html" title="previous page">
      <i class="fas fa-angle-left"></i>
      <div class="prev-next-info">
          <p class="prev-next-subtitle">previous</p>
          <p class="prev-next-title">Harp Binary Protocol</p>
      </div>
  </a>
  <a class='right-next' id="next-link" href="common_registers_operation_devices.html" title="next page">
  <div class="prev-next-info">
      <p class="prev-next-subtitle">next</p>
      <p class="prev-next-title">Harp device common registers and operation</p>
  </div>
  <i class="fas fa-angle-right"></i>
  </a>
</div>
            </footer>
            
          </div>
          
          
          
            <div class="bd-sidebar-secondary bd-toc">
              
<div class="toc-item">
  
<div class="tocsection onthispage">
    <i class="fas fa-list"></i> On this page
</div>
<nav id="bd-toc-nav" class="page-toc">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   1. Introduction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#serial-configuration">
   2. Serial configuration
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#example-code">
   3. Example code
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#physical-connection">
   4. Physical connection
  </a>
 </li>
</ul>

</nav>
</div>

<div class="toc-item">
  

<div class="tocsection editthispage">
    <a href="https://github.com/ahleighton/harp-docs/edit/main/source/About/How-HARP-works/clock_sync.rst">
        <i class="fas fa-pencil-alt"></i> Edit this page
    </a>
</div>

</div>

<div class="toc-item">
  
<div class="tocsection sourcelink">
    <a href="../../_sources/About/How-HARP-works/clock_sync.rst.txt">
        <i class="fas fa-file-alt"></i> Show Source
    </a>
</div>

</div>

            </div>
          
          
        </div>
        <footer class="bd-footer-content">
          <div class="bd-footer-content__inner">
            
          </div>
        </footer>
        
      </main>
    </div>
  </div>

  
    
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=9b1a4fa89bdd0e95b23b"></script>

  <footer class="bd-footer"><div class="bd-footer__inner container">
  
  <div class="footer-item">
    
<p class="copyright">

    &copy; Copyright 2010-2022, Open Ephys &amp; Contributors.<br>

</p>

  </div>
  
  <div class="footer-item">
    
<p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.2.2.<br>
</p>

  </div>
  
</div>
  </footer>
  </body>
</html>