
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Harp Binary Protocol &#8212; HARP Documentation 0.0.0 documentation</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/_static/custom.js"></script>
    <link rel="shortcut icon" href="../../_static/harp.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Synchronization Clock" href="clock_sync.html" />
    <link rel="prev" title="Harp Protocols" href="index.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../../index.html">
  <img src="../../_static/harp.png" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../index.html">
  About
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../Devices/device_list.html">
  Device List
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../Using-HARP/index.html">
  Using HARP
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="index.html">
  Harp Protocols
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
      <div class="navbar-end-item">
        <form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <div class="col-12 col-md-1 col-xl-2 bd-sidebar no-sidebar"></div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage mt-5 pt-1 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#registers">
   1. Registers
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#messages">
   2. Messages
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#message-structure">
     2.1 Message structure
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#messagetype-1-byte">
       <strong>
        [MessageType]
       </strong>
       (1 byte)
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#length-1-byte">
       <strong>
        [Length]
       </strong>
       (1 byte)
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#address-1-byte">
       <strong>
        [Address]
       </strong>
       (1 byte)
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#port-1-byte">
       <strong>
        [Port]
       </strong>
       (1 byte)
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#payloadtype-1-byte">
       <strong>
        [PayloadType]
       </strong>
       (1 byte)
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#payload-byte-s">
       <strong>
        [Payload]
       </strong>
       (? byte(s))
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#checksum-1-byte">
       <strong>
        [Checksum]
       </strong>
       (1 byte)
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#features-and-code-examples">
     2.2 Features and Code Examples
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id1">
       <strong>
        [MessageType]
       </strong>
       (1 byte)
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id2">
       <strong>
        [Length]
       </strong>
       (1 byte)
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id3">
       <strong>
        [PayloadType]
       </strong>
       (1 byte)
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id4">
       <strong>
        [PayloadType]
       </strong>
       (1 byte)
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id5">
       <strong>
        [Checksum]
       </strong>
       (1 byte)
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#payload-and-arrays">
     2.2 Payload and Arrays
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#typical-usage">
   3. Typical Usage
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#commands">
     3.1 Commands
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#write">
       == WRITE ==
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#read">
       == READ ==
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#event">
       == EVENT ==
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                

<div class="tocsection editthispage">
    <a href="https://github.com/filcarv/docs/edit/main/source/About/How-HARP-works/binary_protocol.rst">
        <i class="fas fa-pencil-alt"></i> Edit this page
    </a>
</div>

              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-11 col-xl-8 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <section id="harp-binary-protocol">
<span id="refbinaryprotocol"></span><h1>Harp Binary Protocol<a class="headerlink" href="#harp-binary-protocol" title="Permalink to this headline">#</a></h1>
<p>Harp devices and the host computer send each other messages in order to perform their functions, such as configuring device settings or reading out data. The Harp Binary Protocol specifies how these messages should be structured so that devices can communicate with each other.</p>
<p>In short, devices use registers to interface with the host computer. Each register can be read from, and most can be written to, to set configurations and read datastreams. Each register has a specific function, a datatype, and a unique address. Within a register, each bit has a specific function. Devices can send messages to each other (following the message protocol) to write to or read from other devices’ registers.</p>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#registers" id="id6">1. Registers</a></p></li>
<li><p><a class="reference internal" href="#messages" id="id7">2. Messages</a></p>
<ul>
<li><p><a class="reference internal" href="#message-structure" id="id8">2.1 Message structure</a></p></li>
<li><p><a class="reference internal" href="#features-and-code-examples" id="id9">2.2 Features and Code Examples</a></p></li>
<li><p><a class="reference internal" href="#payload-and-arrays" id="id10">2.2 Payload and Arrays</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#typical-usage" id="id11">3. Typical Usage</a></p>
<ul>
<li><p><a class="reference internal" href="#commands" id="id12">3.1 Commands</a></p></li>
</ul>
</li>
</ul>
</div>
<section id="registers">
<h2><a class="toc-backref" href="#id6">1. Registers</a><a class="headerlink" href="#registers" title="Permalink to this headline">#</a></h2>
<p>Registers contain highly structured information about specific aspects of a device. For instance, one register will contain the system timestamp in seconds, and another may determine whether an LED is on. Writing to registers can set device configurations, whereas reading register values can provide information about the device or stream data.</p>
<p>Every Harp device must have the same 15 ‘Common’ registers, plus additional registers specific to the device. Each register has a specific purpose, described in its Name. It also has an associated Datatype for contents of the register. Note that the Harp Binary Protocol uses Little-Endian for byte organization, meaning that the least significant value in the sequence is stored first.</p>
<p>The following registers are common to all Harp devices:</p>
<img alt="../../_images/common_registers.png" class="align-center" src="../../_images/common_registers.png" />
<div class="admonition-example admonition">
<p class="admonition-title">Example</p>
<p>The first register Name is R_WHO_AM_I. The associated datatype is U16; unsigned 16-bit. On every device, this register will contain an U16 ‘word’ that describes which device it is. To find out the device ID, one would want to read register R_WHO_AM_I. To do so, one would use the address associated with this register, address 000. If reading address 000 returned the value 1106, one could look this up in the <a class="reference external" href="https://github.com/harp-tech/protocol#list-of-the-current-devices-ids-reported">list of device IDs</a> to find out that the device is an Input Expander.</p>
</div>
</section>
<section id="messages">
<h2><a class="toc-backref" href="#id7">2. Messages</a><a class="headerlink" href="#messages" title="Permalink to this headline">#</a></h2>
<p>Information about registers, whether to configure them (write to them) or read them, are sent as messages. The available forms of message are:</p>
<ul class="simple">
<li><p>Command: Sent by the Controller to the Peripheral. Commands can change or read register content.</p></li>
<li><p>Reply: Sent by the Peripheral as an answer to a Controller.</p></li>
<li><p>Event: Sent by the Peripheral when an external or internal event happens. An Event carry the content of a register.</p></li>
</ul>
<section id="message-structure">
<h3><a class="toc-backref" href="#id8">2.1 Message structure</a><a class="headerlink" href="#message-structure" title="Permalink to this headline">#</a></h3>
<p>A Harp message sent between devices follows this structure:</p>
<p>== Harp Message ==
<strong>[MessageType] [Length] [Address] [Port] [PayloadType] [Payload] [Checksum]</strong></p>
<p>Where each section corresponds to the following information:</p>
<section id="messagetype-1-byte">
<h4><strong>[MessageType]</strong> (1 byte)<a class="headerlink" href="#messagetype-1-byte" title="Permalink to this headline">#</a></h4>
<ul class="simple">
<li><p>1 – Read : The device requests the content of the register with address [Address]</p></li>
<li><p>2 – Write : The device is writing the content to the register with address [Address]</p></li>
<li><p>3 – Event : The device is sending the content of the register with address [Address]</p></li>
</ul>
</section>
<section id="length-1-byte">
<h4><strong>[Length]</strong> (1 byte)<a class="headerlink" href="#length-1-byte" title="Permalink to this headline">#</a></h4>
<ul class="simple">
<li><p>The number of bytes in the Harp Message still to be read, i.e., the number of bytes after</p></li>
</ul>
<p>the field [Length].</p>
</section>
<section id="address-1-byte">
<h4><strong>[Address]</strong> (1 byte)<a class="headerlink" href="#address-1-byte" title="Permalink to this headline">#</a></h4>
<ul class="simple">
<li><p>The address to which the Harp Message refers to.</p></li>
</ul>
</section>
<section id="port-1-byte">
<h4><strong>[Port]</strong> (1 byte)<a class="headerlink" href="#port-1-byte" title="Permalink to this headline">#</a></h4>
<ul class="simple">
<li><p>If the device is a Hub of Harp Messages, this field indicates the origin or destination of</p></li>
</ul>
<p>the Harp Message.
To point to the device itself this field should be equal to 255.</p>
</section>
<section id="payloadtype-1-byte">
<h4><strong>[PayloadType]</strong> (1 byte)<a class="headerlink" href="#payloadtype-1-byte" title="Permalink to this headline">#</a></h4>
<ul>
<li><p>Indicates the type of data available on the [Payload]. The [Payload] can contain:</p>
<ul class="simple">
<li><p>An element T</p></li>
<li><p>Or a timestamped element Timestamped&lt;T&gt;</p></li>
</ul>
<p>If the Type is <strong>Timestamped&lt;T&gt;</strong>, the first 6 bytes contains the time information and is
divided into [TimestampSeconds] (4 bytes) and [TimestampMicroseconds] (2 bytes).</p>
<ul class="simple">
<li><p>[TimestampSeconds] - Unsigned 32 bits containing the seconds.</p></li>
<li><p>[TimestampMicroseconds] - Unsigned 16 bits containing the microseconds divided by 32.</p></li>
</ul>
<p>The time information can be retrieved using the formula:</p>
<ul class="simple">
<li><p>Timestamp(s) = [TimestampSeconds] + [TimestampMicroseconds] * 32 * 10-6</p></li>
</ul>
<details closed><summary> List of all available types of [Payload]:
</summary>

<table>
    <thead>
        <tr>
            <th colspan="2"></th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>1 - T U8 :</td>
            <td>Unsigned 8 bits</td>
        </tr>
        <tr>
            <td>2 - T U16 :</td>
            <td>Unsigned 16 bits</td>
        </tr>
        <tr>
            <td>4 - T U32 :</td>
            <td>Unsigned 32 bits</td>
        </tr>
        <tr>
            <td>8 - T U64 :</td>
            <td>Unsigned 64 bits</td>
        </tr>
        <tr>
            <td>129 - T I8 :</td>
            <td>Signed 8 bits</td>
        </tr>
        <tr>
            <td>130 - T I16 :</td>
            <td>Signed 16 bits</td>
        </tr>
        <tr>
            <td>132 - T I32 :</td>
            <td>Signed 32 bits</td>
        </tr>
        <tr>
            <td>136 - T I64 :</td>
            <td>Signed 64 bits</td>
        </tr>
        <tr>
            <td>68 - T Float :</td>
            <td>Single-precision floating-point 32 bits</td>
        </tr>
        <tr>
            <td>16 - Timestamped<> :</td>
            <td>Time information only</td>
        </tr>
        <tr>
            <td>17 - Timestamped<T> U8:</td>
            <td>Timestamped unsigned 8 bits</td>
        </tr>
        <tr>
            <td>18 - Timestamped<T> U16:</td>
            <td>Timestamped unsigned 16 bits</td>
        </tr>
        <tr>
            <td>20 - Timestamped<T> U32:</td>
            <td>Timestamped unsigned 32 bits</td>
        </tr>
        <tr>
            <td>24 - Timestamped<T> U64:</td>
            <td>Timestamped unsigned 64 bits</td>
        </tr>
        <tr>
            <td>145 - Timestamped<T> I8:</td>
            <td>Timestamped signed 8 bits</td>
        </tr>
        <tr>
            <td>146 - Timestamped<T> I16:</td>
            <td>Timestamped signed 16 bits</td>
        </tr>
        <tr>
            <td>148 - Timestamped<T> I32:</td>
            <td>Timestamped signed 32 bits</td>
        </tr>
        <tr>
            <td>152 - Timestamped<T> I64:</td>
            <td>Timestamped signed 64 bits</td>
        </tr>
        <tr>
            <td>84 - Timestamped<T> Float:</td>
            <td>Timestamped Single-precision floating-point 32 bits</td>
        </tr>

    </tbody>
</table>
</div>
</details></li>
</ul>
</section>
<section id="payload-byte-s">
<h4><strong>[Payload]</strong> (? byte(s))<a class="headerlink" href="#payload-byte-s" title="Permalink to this headline">#</a></h4>
<p>The content.</p>
</section>
<section id="checksum-1-byte">
<h4><strong>[Checksum]</strong> (1 byte)<a class="headerlink" href="#checksum-1-byte" title="Permalink to this headline">#</a></h4>
<p>The U8 (unsigned 8 bits) sum of all bytes of the Harp Data.
The receiver of the package should compute himself this checksum and compare with the one
present on the Harp Message. The Harp Message should be discarded if both do not match.</p>
</section>
</section>
<section id="features-and-code-examples">
<h3><a class="toc-backref" href="#id9">2.2 Features and Code Examples</a><a class="headerlink" href="#features-and-code-examples" title="Permalink to this headline">#</a></h3>
<p>Some of the fields described on the previous chapter have special features:</p>
<section id="id1">
<h4><strong>[MessageType]</strong> (1 byte)<a class="headerlink" href="#id1" title="Permalink to this headline">#</a></h4>
<p>The field [Command] has an Error flag on the 4th least significant bit. When this bit is
set it means that an error occur.
Examples of possible errors cane be a) when Controller tries to read a register that doesn’t
exist, b) Controller tries to write unacceptable data to a certain register, c) [PayloadType]
doesn’t match with the register [Address] type, etc.
A simple code in C to check for error will be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>int errorMask = 0x08;

if (Command &amp; errorMask)
{
  printf(“Error detected.\n”);
}
</pre></div>
</div>
</section>
<section id="id2">
<h4><strong>[Length]</strong> (1 byte)<a class="headerlink" href="#id2" title="Permalink to this headline">#</a></h4>
<p>If one byte is not enough to express the length of the Harp Message, use [Length] equal to
255 and add after an unsigned 16 bits word with the Harp Message length.</p>
<p>Replace the [Length] with:</p>
<blockquote>
<div><p>[255] (1 byte) [ExtendedLength] (2 bytes)</p>
</div></blockquote>
</section>
<section id="id3">
<h4><strong>[PayloadType]</strong> (1 byte)<a class="headerlink" href="#id3" title="Permalink to this headline">#</a></h4>
<p>For the definition of the [PayloadType] types, a C# code is presented.
Note that the time information can appear without an element <strong>Timestamp&lt;&gt;</strong>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">isUnsigned</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
<span class="nb">int</span> <span class="n">isSigned</span> <span class="o">=</span> <span class="mh">0x80</span><span class="p">;</span>
<span class="nb">int</span> <span class="n">isFloat</span> <span class="o">=</span> <span class="mh">0x40</span><span class="p">;</span>
<span class="nb">int</span> <span class="n">hasTimestamp</span> <span class="o">=</span> <span class="mh">0x10</span><span class="p">;</span>

<span class="n">enum</span> <span class="n">PayloadType</span>
<span class="p">{</span>
    <span class="n">U8</span> <span class="o">=</span> <span class="p">(</span><span class="n">isUnsigned</span> <span class="o">|</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">S8</span> <span class="o">=</span> <span class="p">(</span><span class="n">isSigned</span> <span class="o">|</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">U16</span> <span class="o">=</span> <span class="p">(</span><span class="n">isUnsigned</span> <span class="o">|</span> <span class="mi">2</span><span class="p">),</span>
    <span class="n">S16</span> <span class="o">=</span> <span class="p">(</span><span class="n">isSigned</span> <span class="o">|</span> <span class="mi">2</span><span class="p">),</span>
    <span class="n">U32</span> <span class="o">=</span> <span class="p">(</span><span class="n">isUnsigned</span> <span class="o">|</span> <span class="mi">4</span><span class="p">),</span>
    <span class="n">S32</span> <span class="o">=</span> <span class="p">(</span><span class="n">isSigned</span> <span class="o">|</span> <span class="mi">4</span><span class="p">),</span>
    <span class="n">U64</span> <span class="o">=</span> <span class="p">(</span><span class="n">isUnsigned</span> <span class="o">|</span> <span class="mi">8</span><span class="p">),</span>
    <span class="n">S64</span> <span class="o">=</span> <span class="p">(</span><span class="n">isSigned</span> <span class="o">|</span> <span class="mi">8</span><span class="p">),</span>
    <span class="n">Float</span> <span class="o">=</span> <span class="p">(</span><span class="n">isFloat</span> <span class="o">|</span> <span class="mi">4</span><span class="p">),</span>
    <span class="n">Timestamp</span> <span class="o">=</span> <span class="n">hasTimestamp</span><span class="p">,</span>
    <span class="n">TimestampedU8</span> <span class="o">=</span> <span class="p">(</span><span class="n">hasTimestamp</span> <span class="o">|</span> <span class="n">U8</span><span class="p">),</span>
    <span class="n">TimestampedS8</span> <span class="o">=</span> <span class="p">(</span><span class="n">hasTimestamp</span> <span class="o">|</span> <span class="n">S8</span><span class="p">),</span>
    <span class="n">TimestampedU16</span> <span class="o">=</span> <span class="p">(</span><span class="n">hasTimestamp</span> <span class="o">|</span> <span class="n">U16</span><span class="p">),</span>
    <span class="n">TimestampedS16</span> <span class="o">=</span> <span class="p">(</span><span class="n">hasTimestamp</span> <span class="o">|</span> <span class="n">S16</span><span class="p">),</span>
    <span class="n">TimestampedU32</span> <span class="o">=</span> <span class="p">(</span><span class="n">hasTimestamp</span> <span class="o">|</span> <span class="n">U32</span><span class="p">),</span>
    <span class="n">TimestampedS32</span> <span class="o">=</span> <span class="p">(</span><span class="n">hasTimestamp</span> <span class="o">|</span> <span class="n">S32</span><span class="p">),</span>
    <span class="n">TimestampedU64</span> <span class="o">=</span> <span class="p">(</span><span class="n">hasTimestamp</span> <span class="o">|</span> <span class="n">U64</span><span class="p">),</span>
    <span class="n">TimestampedS64</span> <span class="o">=</span> <span class="p">(</span><span class="n">hasTimestamp</span> <span class="o">|</span> <span class="n">S64</span><span class="p">),</span>
    <span class="n">TimestampedFloat</span> <span class="o">=</span> <span class="p">(</span><span class="n">hasTimestamp</span> <span class="o">|</span> <span class="n">Float</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="id4">
<h4><strong>[PayloadType]</strong> (1 byte)<a class="headerlink" href="#id4" title="Permalink to this headline">#</a></h4>
<p>The field <strong>[PayloadType]</strong> has a flag on the 5th least significant bit that indicates if the
time information is available on the Harp Message. For some reasons, the time information
may not make sense to appear on the Harp Message.
A simple code in C to check if the time information is available will be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>int hasTimestamp = 0x10;
if (PayloadType &amp; hasTimestamp )
{
printf(“The time information is available on the Harp Message’s Payload.\n”);
}
</pre></div>
</div>
</section>
<section id="id5">
<h4><strong>[Checksum]</strong> (1 byte)<a class="headerlink" href="#id5" title="Permalink to this headline">#</a></h4>
<p>Example on how to calculate the <strong>[Checksum]</strong> in C language.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">unsigned</span> <span class="n">char</span> <span class="n">Checksum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="nb">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">for</span> <span class="p">(;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">Length</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="n">Checksum</span> <span class="o">+=</span> <span class="n">HarpMessage</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="payload-and-arrays">
<h3><a class="toc-backref" href="#id10">2.2 Payload and Arrays</a><a class="headerlink" href="#payload-and-arrays" title="Permalink to this headline">#</a></h3>
<p>The [payload]’s element can contain a single value or an array of values. To find the amount of values a simple
code can be applied using the information contained on the [Length] and the [PayloadType].
Example to calculate the number of values on the [Payload]’s element in C language:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>int arrayLength;
int hasTimestamp = 0x10;
int sizeMask = 0x0F;

if (PayloadType &amp; hasTimestamp )
{
    /* Harp Message has time information
    arrayLength = (Length – 10) / (PayloadType &amp; sizeMask )
}
else
{
    /* Harp Message doesn’t have time information
    arrayLength = (Length – 4) / (PayloadType &amp; sizeMask )
}
</pre></div>
</div>
</section>
</section>
<section id="typical-usage">
<h2><a class="toc-backref" href="#id11">3. Typical Usage</a><a class="headerlink" href="#typical-usage" title="Permalink to this headline">#</a></h2>
<section id="commands">
<h3><a class="toc-backref" href="#id12">3.1 Commands</a><a class="headerlink" href="#commands" title="Permalink to this headline">#</a></h3>
<p>Usually the Peripheral device that runs this protocol receives Write and Read commands from the Controller and sends Events to the Controller.
Some Harp Messages are shown here to demonstrate the typical usage. Note that, from the Controller to the Peripheral, the time information is not added to the Harp Message since this information is not necessary.</p>
<p>Note: [CMD] is a Command, [RPL] is a Reply and [EVT] is an Event.</p>
<section id="write">
<h4>== WRITE ==<a class="headerlink" href="#write" title="Permalink to this headline">#</a></h4>
<p>From Controller to Peripheral. Peripheral replies.</p>
<ul class="simple">
<li><p>[CMD] Controller: 2 <span class="blue">Length Address Port</span> <span class="green">PayloadType</span> <span class="red">T</span> Checksum</p></li>
<li><p>[RPL] Peripheral: 2 <span class="blue">Length Address Port</span>  <span class="green">PayloadType</span> <span class="red">Timestamp&lt;T&gt;</span> Checksum OK</p></li>
<li><p>[RPL] Peripheral: 10 <span class="blue">Length Address Port</span>  <span class="green">PayloadType</span> <span class="red">Timestamp&lt;T&gt;</span> Checksum ERROR</p></li>
</ul>
<p>The time information contains the time when the register with Address was updated.</p>
</section>
<section id="read">
<h4>== READ ==<a class="headerlink" href="#read" title="Permalink to this headline">#</a></h4>
<p>From Controller to Peripheral. Peripheral replies.</p>
<ul class="simple">
<li><p>[CMD] Controller: 1 <span class="blue">4 Address Port</span>  <span class="green">PayloadType</span> Checksum</p></li>
<li><p>[RPL] Peripheral: 1 <span class="blue">Length Address Port</span> <span class="green">PayloadType</span> <span class="red">Timestamp&lt;T&gt;</span> Checksum OK</p></li>
<li><p>[RPL] Peripheral: 9 <span class="blue">10 Address Port</span> <span class="green">PayloadType</span> <span class="red">Timestamp&lt;&gt;</span> Checksum ERROR</p></li>
</ul>
<p>The time information contains the time when the register with Address was read.</p>
</section>
<section id="event">
<h4>== EVENT ==<a class="headerlink" href="#event" title="Permalink to this headline">#</a></h4>
<p>Always from Peripheral to Controller.</p>
<ul class="simple">
<li><p>[EVT] Peripheral: 3 <span class="blue">Length Address Port</span> <span class="green">PayloadType</span> <span class="red">Timestamp&lt;T&gt;</span> Checksum</p></li>
</ul>
<p>The time information contains the time when the register with Address was read.</p>
</section>
</section>
</section>
</section>


              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="index.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Harp Protocols</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="clock_sync.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Synchronization Clock</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
              
          </main>
          

      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2022-2022, Harp &amp; Contributors.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.5.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>